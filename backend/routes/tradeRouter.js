const express = require("express");
const { OpenAI } = require("openai");
const { getLeague } = require("../db/queries");
require("dotenv").config();

const router = express.Router();
const client = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });

router.get("/:leagueid", async (req, res) => {
  const { leagueid } = req.params;
  const leagueData = await getLeague(leagueid);

  const league_name = leagueData.name;
  const roster_positions = leagueData.roster_positions;
  const scoring_settings = leagueData.scoring_settings;
  const response = await client.responses.create({
    model: "gpt-4.1-mini",
    input: [
      {
        role: "system",
        content: [
          {
            type: "input_text",
            text: 'You are a fantasy football expert (like an ESPN analyst) tasked with analyzing user teams, league context, and proposing fair, realistic trades within league roster settings.\nYou are given:\nuser_roster: The user’s players.\nleague_rosters: list of lists containing each teams players.\nroster_positions: Starting requirements and position limits.\npoints_per_rec: Points per reception (influences receiving player value).\nYour objectives:\nEvaluate the user\'s strengths and weaknesses based on positional needs, depth, and starting lineup requirements.\nAssess at least one trade partner’s roster the same way. \nConsider roster structure, depth, positional scarcity, bye weeks, and injuries.\nRecommend balanced trades that help both teams without creating lineup holes.\nAvoid unrealistic or lopsided offers.\nOutput format:\nReturn a JSON object like this:\n{players_received: [], players_traded: [], with_team: "", explanation: ""}, where players_received is the players received by the user\'s roster, players_traded is the players the user gives to the other team, with_team is the name of user for the team user is trading with, and explanation is a two-sentence summary of why this is a good trade for both teams.',
          },
        ],
      },
      {
        role: "user",
        content: [
          {
            type: "input_text",
            text: '{     "owner_name": "andybello",     "players": [         {             "name": "Rashee Rice",             "positions": [                 "WR"             ],             "team": "KC"         },         {             "name": "Jayden Daniels",             "positions": [                 "QB"             ],             "team": "WAS"         },         {             "name": "Luther Burden",             "positions": [                 "WR"             ],             "team": "CHI"         },         {             "name": "Davante Adams",             "positions": [                 "WR"             ],             "team": "LAR"         },         {             "name": "Danielle Hunter",             "positions": [                 "DL",                 "LB"             ],             "team": "HOU"         },         {             "name": "T.J. Watt",             "positions": [                 "DL",                 "LB"             ],             "team": "PIT"         },         {             "name": "George Kittle",             "positions": [                 "TE"             ],             "team": "SF"         },         {             "name": "Younghoe Koo",             "positions": [                 "K"             ],             "team": "ATL"         },         {             "name": "Jordan Love",             "positions": [                 "QB"             ],             "team": "GB"         },         {             "name": "Joshua Metellus",             "positions": [                 "DB",                 "LB"             ],             "team": "MIN"         },         {             "name": "Kyle Pitts",             "positions": [                 "TE"             ],             "team": "ATL"         },         {             "name": "Chuba Hubbard",             "positions": [                 "RB"             ],             "team": "CAR"         },         {             "name": "George Pickens",             "positions": [                 "WR"             ],             "team": "DAL"         },         {             "name": "Nik Bonitto",             "positions": [                 "DL",                 "LB"             ],             "team": "DEN"         }     ] }',
          },
        ],
      },
      {
        role: "user",
        content: [
          {
            type: "input_text",
            text: '[     {         "owner_name": "donny1976",         "players": [             {                 "name": "Xavier Worthy",                 "positions": [                     "WR"                 ],                 "team": "KC"             },             {                 "name": "Tyler Nubin",                 "positions": [                     "DB"                 ],                 "team": "NYG"             },             {                 "name": "Stefon Diggs",                 "positions": [                     "WR"                 ],                 "team": "NE"             },             {                 "name": "Darren Waller",                 "positions": [                     "TE"                 ],                 "team": "MIA"             },             {                 "name": "Dak Prescott",                 "positions": [                     "QB"                 ],                 "team": "DAL"             },             {                 "name": "Tyreek Hill",                 "positions": [                     "WR"                 ],                 "team": "MIA"             },             {                 "name": "Christian McCaffrey",                 "positions": [                     "RB"                 ],                 "team": "SF"             },             {                 "name": "Evan Engram",                 "positions": [                     "TE"                 ],                 "team": "DEN"             },             {                 "name": "Harrison Butker",                 "positions": [                     "K"                 ],                 "team": "KC"             },             {                 "name": "Calvin Ridley",                 "positions": [                     "WR"                 ],                 "team": "TEN"             },             {                 "name": "A.J. Brown",                 "positions": [                     "WR"                 ],                 "team": "PHI"             },             {                 "name": "Tony Pollard",                 "positions": [                     "RB"                 ],                 "team": "TEN"             },             {                 "name": "Tua Tagovailoa",                 "positions": [                     "QB"                 ],                 "team": "MIA"             },             {                 "name": "D\'Andre Swift",                 "positions": [                     "RB"                 ],                 "team": "CHI"             },             {                 "name": "Bijan Robinson",                 "positions": [                     "RB"                 ],                 "team": "ATL"             },             {                 "name": "New York Giants",                 "positions": [                     "DEF"                 ],                 "team": "NYG"             }         ]     },     {         "owner_name": "isahasonaira",         "players": [             {                 "name": "Dalton Kincaid",                 "positions": [                     "TE"                 ],                 "team": "BUF"             },             {                 "name": "Brandon Aubrey",                 "positions": [                     "K"                 ],                 "team": "DAL"             },             {                 "name": "Caleb Williams",                 "positions": [                     "QB"                 ],                 "team": "CHI"             },             {                 "name": "Marvin Harrison",                 "positions": [                     "WR"                 ],                 "team": "ARI"             },             {                 "name": "Mike Evans",                 "positions": [                     "WR"                 ],                 "team": "TB"             },             {                 "name": "Joe Mixon",                 "positions": [                     "RB"                 ],                 "team": "HOU"             },             {                 "name": "Cooper Kupp",                 "positions": [                     "WR"                 ],                 "team": "SEA"             },             {                 "name": "Jauan Jennings",                 "positions": [                     "WR"                 ],                 "team": "SF"             },             {                 "name": "Ja\'Marr Chase",                 "positions": [                     "WR"                 ],                 "team": "CIN"             },             {                 "name": "Nico Collins",                 "positions": [                     "WR"                 ],                 "team": "HOU"             },             {                 "name": "Ernest Jones",                 "positions": [                     "LB"                 ],                 "team": "SEA"             },             {                 "name": "Isiah Pacheco",                 "positions": [                     "RB"                 ],                 "team": "KC"             },             {                 "name": "Aidan Hutchinson",                 "positions": [                     "DL"                 ],                 "team": "DET"             },             {                 "name": "Kyle Hamilton",                 "positions": [                     "DB"                 ],                 "team": "BAL"             },             {                 "name": "Bryce Young",                 "positions": [                     "QB"                 ],                 "team": "CAR"             },             {                 "name": "Seattle Seahawks",                 "positions": [                     "DEF"                 ],                 "team": "SEA"             }         ]     },     {         "owner_name": "agbjay",         "players": [             {                 "name": "TreVeyon Henderson",                 "positions": [                     "RB"                 ],                 "team": "NE"             },             {                 "name": "Travis Hunter",                 "positions": [                     "DB",                     "WR"                 ],                 "team": "JAX"             },             {                 "name": "Travis Kelce",                 "positions": [                     "TE"                 ],                 "team": "KC"             },             {                 "name": "Alex Singleton",                 "positions": [                     "LB"                 ],                 "team": "DEN"             },             {                 "name": "Lamar Jackson",                 "positions": [                     "QB"                 ],                 "team": "BAL"             },             {                 "name": "Terry McLaurin",                 "positions": [                     "WR"                 ],                 "team": "WAS"             },             {                 "name": "T.J. Edwards",                 "positions": [                     "LB"                 ],                 "team": "CHI"             },             {                 "name": "J.K. Dobbins",                 "positions": [                     "RB"                 ],                 "team": "DEN"             },             {                 "name": "Darnell Mooney",                 "positions": [                     "WR"                 ],                 "team": "ATL"             },             {                 "name": "Trevor Lawrence",                 "positions": [                     "QB"                 ],                 "team": "JAX"             },             {                 "name": "Jameson Williams",                 "positions": [                     "WR"                 ],                 "team": "DET"             },             {                 "name": "Breece Hall",                 "positions": [                     "RB"                 ],                 "team": "NYJ"             },             {                 "name": "Cameron Dicker",                 "positions": [                     "K"                 ],                 "team": "LAC"             },             {                 "name": "Jordan Mason",                 "positions": [                     "RB"                 ],                 "team": "MIN"             },             {                 "name": "Jordan Addison",                 "positions": [                     "WR"                 ],                 "team": "MIN"             },             {                 "name": "Philadelphia Eagles",                 "positions": [                     "DEF"                 ],                 "team": "PHI"             }         ]     },     {         "owner_name": "justinbomrard",         "players": [             {                 "name": "Brian Branch",                 "positions": [                     "DB"                 ],                 "team": "DET"             },             {                 "name": "Jake Bates",                 "positions": [                     "K"                 ],                 "team": "DET"             },             {                 "name": "Ladd McConkey",                 "positions": [                     "WR"                 ],                 "team": "LAC"             },             {                 "name": "Quinshon Judkins",                 "positions": [                     "RB"                 ],                 "team": "CLE"             },             {                 "name": "Jared Goff",                 "positions": [                     "QB"                 ],                 "team": "DET"             },             {                 "name": "Josh Allen",                 "positions": [                     "QB"                 ],                 "team": "BUF"             },             {                 "name": "Mark Andrews",                 "positions": [                     "TE"                 ],                 "team": "BAL"             },             {                 "name": "Foyesade Oluokun",                 "positions": [                     "LB"                 ],                 "team": "JAX"             },             {                 "name": "Brian Burns",                 "positions": [                     "DL"                 ],                 "team": "NYG"             },             {                 "name": "Jaylen Waddle",                 "positions": [                     "WR"                 ],                 "team": "MIA"             },             {                 "name": "Drake London",                 "positions": [                     "WR"                 ],                 "team": "ATL"             },             {                 "name": "Khalil Shakir",                 "positions": [                     "WR"                 ],                 "team": "BUF"             },             {                 "name": "Chris Olave",                 "positions": [                     "WR"                 ],                 "team": "NO"             },             {                 "name": "Kenneth Walker",                 "positions": [                     "RB"                 ],                 "team": "SEA"             },             {                 "name": "Nick Cross",                 "positions": [                     "DB"                 ],                 "team": "IND"             },             {                 "name": "New England Patriots",                 "positions": [                     "DEF"                 ],                 "team": "NE"             }         ]     },     {         "owner_name": "ejb1234",         "players": [             {                 "name": "Jayden Reed",                 "positions": [                     "WR"                 ],                 "team": "GB"             },             {                 "name": "Bucky Irving",                 "positions": [                     "RB"                 ],                 "team": "TB"             },             {                 "name": "Keon Coleman",                 "positions": [                     "WR"                 ],                 "team": "BUF"             },             {                 "name": "Matthew Golden",                 "positions": [                     "WR"                 ],                 "team": "GB"             },             {                 "name": "Cameron Ward",                 "positions": [                     "QB"                 ],                 "team": "TEN"             },             {                 "name": "Myles Garrett",                 "positions": [                     "DL"                 ],                 "team": "CLE"             },             {                 "name": "Baker Mayfield",                 "positions": [                     "QB"                 ],                 "team": "TB"             },             {                 "name": "DJ Moore",                 "positions": [                     "WR"                 ],                 "team": "CHI"             },             {                 "name": "Xavier McKinney",                 "positions": [                     "DB"                 ],                 "team": "GB"             },             {                 "name": "Justin Jefferson",                 "positions": [                     "WR"                 ],                 "team": "MIN"             },             {                 "name": "Tyler Bass",                 "positions": [                     "K"                 ],                 "team": "BUF"             },             {                 "name": "Trey McBride",                 "positions": [                     "TE"                 ],                 "team": "ARI"             },             {                 "name": "Brian Robinson",                 "positions": [                     "RB"                 ],                 "team": "WAS"             },             {                 "name": "Chase Brown",                 "positions": [                     "RB"                 ],                 "team": "CIN"             },             {                 "name": "Josh Downs",                 "positions": [                     "WR"                 ],                 "team": "IND"             },             {                 "name": "Denver Broncos",                 "positions": [                     "DEF"                 ],                 "team": "DEN"             }         ]     },     {         "owner_name": "rand33zy",         "players": [             {                 "name": "Rome Odunze",                 "positions": [                     "WR"                 ],                 "team": "CHI"             },             {                 "name": "Brian Thomas",                 "positions": [                     "WR"                 ],                 "team": "JAX"             },             {                 "name": "Chris Boswell",                 "positions": [                     "K"                 ],                 "team": "PIT"             },             {                 "name": "Roquan Smith",                 "positions": [                     "LB"                 ],                 "team": "BAL"             },             {                 "name": "Dallas Goedert",                 "positions": [                     "TE"                 ],                 "team": "PHI"             },             {                 "name": "T.J. Hockenson",                 "positions": [                     "TE"                 ],                 "team": "MIN"             },             {                 "name": "Josh Jacobs",                 "positions": [                     "RB"                 ],                 "team": "GB"             },             {                 "name": "Deebo Samuel",                 "positions": [                     "WR"                 ],                 "team": "WAS"             },             {                 "name": "Jakobi Meyers",                 "positions": [                     "WR"                 ],                 "team": "LV"             },             {                 "name": "Michael Pittman",                 "positions": [                     "WR"                 ],                 "team": "IND"             },             {                 "name": "Rhamondre Stevenson",                 "positions": [                     "RB"                 ],                 "team": "NE"             },             {                 "name": "Rashid Shaheed",                 "positions": [                     "WR"                 ],                 "team": "NO"             },             {                 "name": "Jahmyr Gibbs",                 "positions": [                     "RB"                 ],                 "team": "DET"             },             {                 "name": "Anthony Richardson",                 "positions": [                     "QB"                 ],                 "team": "IND"             },             {                 "name": "C.J. Stroud",                 "positions": [                     "QB"                 ],                 "team": "HOU"             },             {                 "name": "Baltimore Ravens",                 "positions": [                     "DEF"                 ],                 "team": "BAL"             }         ]     },     {         "owner_name": "Unknown",         "players": [             {                 "name": "Jaydon Blue",                 "positions": [                     "RB"                 ],                 "team": "DAL"             },             {                 "name": "Cam Skattebo",                 "positions": [                     "RB"                 ],                 "team": "NYG"             },             {                 "name": "RJ Harvey",                 "positions": [                     "RB"                 ],                 "team": "DEN"             },             {                 "name": "Omarion Hampton",                 "positions": [                     "RB"                 ],                 "team": "LAC"             },             {                 "name": "Tyler Warren",                 "positions": [                     "TE"                 ],                 "team": "IND"             },             {                 "name": "Tetairoa McMillan",                 "positions": [                     "WR"                 ],                 "team": "CAR"             },             {                 "name": "Tyler Loop",                 "positions": [                     "K"                 ],                 "team": "BAL"             },             {                 "name": "Chris Godwin",                 "positions": [                     "WR"                 ],                 "team": "TB"             },             {                 "name": "Patrick Mahomes",                 "positions": [                     "QB"                 ],                 "team": "KC"             },             {                 "name": "Jessie Bates",                 "positions": [                     "DB"                 ],                 "team": "ATL"             },             {                 "name": "Zaire Franklin",                 "positions": [                     "LB"                 ],                 "team": "IND"             },             {                 "name": "Nick Bosa",                 "positions": [                     "DL"                 ],                 "team": "SF"             },             {                 "name": "Kyler Murray",                 "positions": [                     "QB"                 ],                 "team": "ARI"             },             {                 "name": "CeeDee Lamb",                 "positions": [                     "WR"                 ],                 "team": "DAL"             },             {                 "name": "Zack Baun",                 "positions": [                     "LB"                 ],                 "team": "PHI"             },             {                 "name": "Miami Dolphins",                 "positions": [                     "DEF"                 ],                 "team": "MIA"             }         ]     },     {         "owner_name": "countryroads88",         "players": [             {                 "name": "Tyrone Tracy",                 "positions": [                     "RB"                 ],                 "team": "NYG"             },             {                 "name": "Kaleb Johnson",                 "positions": [                     "RB"                 ],                 "team": "PIT"             },             {                 "name": "Colston Loveland",                 "positions": [                     "TE"                 ],                 "team": "CHI"             },             {                 "name": "Hunter Henry",                 "positions": [                     "TE"                 ],                 "team": "NE"             },             {                 "name": "Jake Elliott",                 "positions": [                     "K"                 ],                 "team": "PHI"             },             {                 "name": "Aaron Jones",                 "positions": [                     "RB"                 ],                 "team": "MIN"             },             {                 "name": "Fred Warner",                 "positions": [                     "LB"                 ],                 "team": "SF"             },             {                 "name": "Kaden Elliss",                 "positions": [                     "LB"                 ],                 "team": "ATL"             },             {                 "name": "Joe Burrow",                 "positions": [                     "QB"                 ],                 "team": "CIN"             },             {                 "name": "Tee Higgins",                 "positions": [                     "WR"                 ],                 "team": "CIN"             },             {                 "name": "DeVonta Smith",                 "positions": [                     "WR"                 ],                 "team": "PHI"             },             {                 "name": "Justin Fields",                 "positions": [                     "QB"                 ],                 "team": "NYJ"             },             {                 "name": "Garrett Wilson",                 "positions": [                     "WR"                 ],                 "team": "NYJ"             },             {                 "name": "Puka Nacua",                 "positions": [                     "WR"                 ],                 "team": "LAR"             },             {                 "name": "Zay Flowers",                 "positions": [                     "WR"                 ],                 "team": "BAL"             },             {                 "name": "Buffalo Bills",                 "positions": [                     "DEF"                 ],                 "team": "BUF"             }         ]     },     {         "owner_name": "taalghul",         "players": [             {                 "name": "Michael Penix",                 "positions": [                     "QB"                 ],                 "team": "ATL"             },             {                 "name": "Bo Nix",                 "positions": [                     "QB"                 ],                 "team": "DEN"             },             {                 "name": "Brock Bowers",                 "positions": [                     "TE"                 ],                 "team": "LV"             },             {                 "name": "Malik Nabers",                 "positions": [                     "WR"                 ],                 "team": "NYG"             },             {                 "name": "Ka\'imi Fairbairn",                 "positions": [                     "K"                 ],                 "team": "HOU"             },             {                 "name": "James Conner",                 "positions": [                     "RB"                 ],                 "team": "ARI"             },             {                 "name": "Jonnu Smith",                 "positions": [                     "TE"                 ],                 "team": "PIT"             },             {                 "name": "Derwin James",                 "positions": [                     "DB"                 ],                 "team": "LAC"             },             {                 "name": "Jordyn Brooks",                 "positions": [                     "LB"                 ],                 "team": "MIA"             },             {                 "name": "Travis Etienne",                 "positions": [                     "RB"                 ],                 "team": "JAX"             },             {                 "name": "Nick Bolton",                 "positions": [                     "LB"                 ],                 "team": "KC"             },             {                 "name": "Kyren Williams",                 "positions": [                     "RB"                 ],                 "team": "LAR"             },             {                 "name": "De\'Von Achane",                 "positions": [                     "RB"                 ],                 "team": "MIA"             },             {                 "name": "Jaxon Smith-Njigba",                 "positions": [                     "WR"                 ],                 "team": "SEA"             },             {                 "name": "Zach Charbonnet",                 "positions": [                     "RB"                 ],                 "team": "SEA"             },             {                 "name": "Pittsburgh Steelers",                 "positions": [                     "DEF"                 ],                 "team": "PIT"             }         ]     },     {         "owner_name": "rebel677",         "players": [             {                 "name": "Will Anderson",                 "positions": [                     "DL",                     "LB"                 ],                 "team": "HOU"             },             {                 "name": "Ricky Pearsall",                 "positions": [                     "WR"                 ],                 "team": "SF"             },             {                 "name": "Emeka Egbuka",                 "positions": [                     "WR"                 ],                 "team": "TB"             },             {                 "name": "Derrick Henry",                 "positions": [                     "RB"                 ],                 "team": "BAL"             },             {                 "name": "David Njoku",                 "positions": [                     "TE"                 ],                 "team": "CLE"             },             {                 "name": "Budda Baker",                 "positions": [                     "DB"                 ],                 "team": "ARI"             },             {                 "name": "Saquon Barkley",                 "positions": [                     "RB"                 ],                 "team": "PHI"             },             {                 "name": "DK Metcalf",                 "positions": [                     "WR"                 ],                 "team": "PIT"             },             {                 "name": "Maxx Crosby",                 "positions": [                     "DL"                 ],                 "team": "LV"             },             {                 "name": "Jerry Jeudy",                 "positions": [                     "WR"                 ],                 "team": "CLE"             },             {                 "name": "Justin Herbert",                 "positions": [                     "QB"                 ],                 "team": "LAC"             },             {                 "name": "Amon-Ra St. Brown",                 "positions": [                     "WR"                 ],                 "team": "DET"             },             {                 "name": "Evan McPherson",                 "positions": [                     "K"                 ],                 "team": "CIN"             },             {                 "name": "James Cook",                 "positions": [                     "RB"                 ],                 "team": "BUF"             },             {                 "name": "Brock Purdy",                 "positions": [                     "QB"                 ],                 "team": "SF"             },             {                 "name": "San Francisco 49ers",                 "positions": [                     "DEF"                 ],                 "team": "SF"             }         ]     },     {         "owner_name": "bigede928",         "players": [             {                 "name": "Cedric Tillman",                 "positions": [                     "WR"                 ],                 "team": "CLE"             },             {                 "name": "Sam LaPorta",                 "positions": [                     "TE"                 ],                 "team": "DET"             },             {                 "name": "J.J. McCarthy",                 "positions": [                     "QB"                 ],                 "team": "MIN"             },             {                 "name": "Ashton Jeanty",                 "positions": [                     "RB"                 ],                 "team": "LV"             },             {                 "name": "Kyle Williams",                 "positions": [                     "WR"                 ],                 "team": "NE"             },             {                 "name": "Alvin Kamara",                 "positions": [                     "RB"                 ],                 "team": "NO"             },             {                 "name": "Courtland Sutton",                 "positions": [                     "WR"                 ],                 "team": "DEN"             },             {                 "name": "David Montgomery",                 "positions": [                     "RB"                 ],                 "team": "DET"             },             {                 "name": "Chase McLaughlin",                 "positions": [                     "K"                 ],                 "team": "TB"             },             {                 "name": "Brandon Aiyuk",                 "positions": [                     "WR"                 ],                 "team": "SF"             },             {                 "name": "Jonathan Taylor",                 "positions": [                     "RB"                 ],                 "team": "IND"             },             {                 "name": "Antoine Winfield",                 "positions": [                     "DB"                 ],                 "team": "TB"             },             {                 "name": "Jalen Hurts",                 "positions": [                     "QB"                 ],                 "team": "PHI"             },             {                 "name": "Micah Parsons",                 "positions": [                     "DL",                     "LB"                 ],                 "team": "DAL"             },             {                 "name": "Jaylen Warren",                 "positions": [                     "RB"                 ],                 "team": "PIT"             },             {                 "name": "Marvin Mims",                 "positions": [                     "WR"                 ],                 "team": "DEN"             },             {                 "name": "Houston Texans",                 "positions": [                     "DEF"                 ],                 "team": "HOU"             }         ]     } ]',
          },
        ],
      },
      {
        role: "user",
        content: [
          {
            type: "input_text",
            text: '[     "QB",     "RB",     "RB",     "WR",     "WR",     "TE",     "FLEX",     "FLEX",     "K",     "DEF",     "IDP_FLEX",     "BN",     "BN",     "BN",     "BN",     "BN" ]',
          },
        ],
      },
      {
        role: "assistant",
        content: [
          {
            type: "output_text",
            text: "{{points_per_rec}}",
          },
        ],
      },
      {
        id: "msg_688cee76d0208194bb0e8b07c7878f3e0728195b86c73c20",
        role: "assistant",
        content: [
          {
            type: "output_text",
            text: '{\n  "players_received": [\n    "Christian McCaffrey",\n    "Stefon Diggs"\n  ],\n  "players_traded": [\n    "Jayden Daniels",\n    "Davante Adams"\n  ],\n  "with_team": "donny1976",\n  "explanation": "AndyBello strengthens his RB and WR starting spots by acquiring elite players like McCaffrey and Diggs, addressing his RB depth need and WR starting quality. Donny1976 gains a quality starting QB depth and a strong WR in Adams, balancing their roster and improving their QB options with Daniels, fitting both teams\' positional needs."\n}',
          },
        ],
      },
    ],
    text: {
      format: {
        type: "json_object",
      },
    },
    reasoning: {},
    tools: [],
    temperature: 1,
    max_output_tokens: 2048,
    top_p: 1,
    store: true,
  });
  res.json({
    output: JSON.parse(response.output_text),
    tokens: response.usage.total_tokens,
  });
});

module.exports = router;
